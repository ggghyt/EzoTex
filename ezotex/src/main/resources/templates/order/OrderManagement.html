<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}" layout:fragment="content">
<head>
<meta charset="UTF-8">
<title>ì´ì¡°í…ìŠ¤SCM</title>
<link rel="stylesheet"
	href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
<script>
// ì¸í’‹ ì´ˆê¸°í™” í•¨ìˆ˜
function resetForm() {
    // ëª¨ë“  input í•„ë“œë¥¼ ë¹„ìš´ë‹¤
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.value = '';  // ê°’ ì´ˆê¸°í™”
    });
}
</script>
</head>
<body>
	<h3 class="fs-3 fw-bold">| ì£¼ë¬¸ ê´€ë¦¬</h3>
	<div class="card card-body mt-3">
		<div class="row">
			<div class="col-5 card card-body m-2"
				style="background-color: #d3d3d3;">
				<p class="fs-5 fw-bolder">ì£¼ë¬¸ ë“±ë¡</p>
				<table class="table mt-3">
					<tbody>
						<!-- ì²« ë²ˆì§¸ ì¤„ -->
						<tr>
							<td class="col-auto"><label class="col-form-label">ì£¼ë¬¸ì½”ë“œ</label>
								<input type="text" id="productOrderCode" class="form-control"
								readonly></td>
							<td class="col-auto"><label class="col-form-label">ì£¼ë¬¸
									ë‹´ë‹¹ì</label> <input type="text" id="charger" class="form-control"
								readonly></td>
							<td class="col-auto"><label class="col-form-label">ì‚¬ì›ì½”ë“œ</label>
								<input type="text" id="empCode" class="form-control"></td>
							<td class="col-auto"><label class="col-form-label">ì—…ì²´ì½”ë“œ</label>
								<input type="text" id="companyCode" class="form-control"
								onclick="showCompanyCodeModal()"></td>
							<td class="col-auto"><label class="col-form-label">ì—…ì²´ëª…</label>
								<input type="text" id="company" class="form-control"></td>
						</tr>
						<!-- ë‘ ë²ˆì§¸ ì¤„ -->
						<tr>
							<td class="col-auto"><label class="col-form-label">ì—…ì²´
									ë‹´ë‹¹ì</label> <input type="text" id="companyRepresentative"
								class="form-control" readonly></td>
							<td class="col-auto"><label class="col-form-label">ì „í™”ë²ˆí˜¸</label>
								<input type="text" id="companyTel" class="form-control">
							</td>
							<td class="col-auto"><label class="col-form-label">ì£¼ë¬¸ì¼</label>
								<input type="date" id="orderDate" class="form-control">
							</td>
							<td class="col-auto"><label class="col-form-label">ë‚©ê¸°ì¼</label>
								<input type="date" id="deliveryRequestDeadline"
								class="form-control"></td>
							<td class="col-auto"><label class="col-form-label">ì£¼ë¬¸ìƒíƒœ</label>
								<input type="text" id="orderStatus" class="form-control"
								readonly></td>
						</tr>
					</tbody>
				</table>
				<label class="col-form-label">ë¹„ê³ </label> <input type="text"
					id="remarks" class="form-control" placeholder="íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
				<button type="button" onclick="resetForm()">ì´ˆê¸°í™”</button>
			</div>
		</div>
		<div class="row">
			<p class="fs-5 fw-bolder" style="margin-top: 50px">
				ì œí’ˆ ëª©ë¡
				<button type="button" class="btn btn-info btn-sm"
					data-bs-toggle="modal" data-bs-target="#productCodeModal"
					style="margin-left: 1400px;">ì œí’ˆ ì¶”ê°€</button>
			</p>
			<div id="grid" style="width: 100%; height: 400px;"></div>
			<script>
    // ê¸°ë³¸ ì˜µì…˜ ì„¤ì •
    const grid = new tui.Grid({
      el: document.getElementById('grid'), // ê·¸ë¦¬ë“œë¥¼ í‘œì‹œí•  ì—˜ë¦¬ë¨¼íŠ¸
      rowHeight: 'auto',  // í–‰ ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì •
      columns: [  // ì»¬ëŸ¼ ì„¤ì • (ë¹ˆ ì»¬ëŸ¼ìœ¼ë¡œ ì´ˆê¸°í™”)
        {
          header: 'NO',
          name: 'no',
          align: 'center',
          width: 80
        },
        {
          header: 'ì œí’ˆ ì½”ë“œ',
          name: 'productCode',
          align: 'center',
          width: 120
        },
        {
          header: 'ì œí’ˆëª…',
          name: 'productName',
          align: 'center',
          width: 150
        },
        {
          header: 'ë‹¨ê°€',
          name: 'unitPrice',
          align: 'right',
          width: 100
        },
        {
          header: 'ì£¼ë¬¸ ìˆ˜ëŸ‰',
          name: 'orderQuantity',
          align: 'right',
          width: 100
        },
        {
          header: 'ì£¼ë¬¸ ê¸ˆì•¡',
          name: 'orderAmount',
          align: 'right',
          width: 120
        }
      ],
      data: [] // ë¹ˆ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
    });
  </script>
		</div>
		<div class="row">
			<div class="col-5 card card-body m-2">
				<p class="fs-5 fw-bolder">ì„ íƒí•œ ì œí’ˆ</p>
				<table class="table mt-3">
					<thead class="table-light text-center">
						<tr>
							<th>í•„ë“œ1</th>
							<th>í•„ë“œ2</th>
							<th>í•„ë“œ3</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>...</td>
							<td>...</td>
							<td>...</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</body>
<!-- ì œí’ˆì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal fade" id="productCodeModal" tabindex="-1"
	aria-labelledby="productCodeModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="productCodeModalLabel">ì œí’ˆ ì„ íƒ</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<!-- ê²€ìƒ‰ì°½ -->
				<div class="mb-3">
					<label for="productCodeSearch" class="form-label">ì œí’ˆ ì½”ë“œ</label> <input
						type="text" id="productCodeSearch" class="form-control"
						placeholder="ì œí’ˆ ì½”ë“œë¡œ ê²€ìƒ‰" oninput="filterGrid()"> <label
						for="productNameSearch" class="form-label">ì œí’ˆëª…</label> <input
						type="text" id="productNameSearch" class="form-control"
						placeholder="ì œí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰" oninput="filterGrid()">
				</div>
				<div class="card card-body mt-3">
					<div class="row">
						<!-- Toast Gridë¥¼ í‘œì‹œí•  div ì¶”ê°€ -->
						<div class="col-12 card card-body m-2">
							<p class="fs-5 fw-bolder">ì œí’ˆ ì„ íƒ ëª¨ë‹¬</p>
							<!-- ê·¸ë¦¬ë“œë¥¼ í‘œì‹œí•  div -->
							<div id="productGrid" style="width: 100%;"></div>
						</div>
					</div>
				</div>

				<script th:inline="javascript">
		// Thymeleafì—ì„œ getProductList ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•´ì„œ JavaScriptë¡œ ì „ë‹¬
		const productList = /*[[${getProductList}]]*/[];

		// ì „ë‹¬ëœ ë°ì´í„° í™•ì¸ (ì½˜ì†”ì— ì¶œë ¥)
		console.log(productList);

		// Toast Grid ì„¤ì •
		const grid2 = new tui.Grid(
				{
					el : document.getElementById('productGrid'), // ê·¸ë¦¬ë“œë¥¼ í‘œì‹œí•  div
					data : productList, // ì„œë²„ì—ì„œ ì „ë‹¬ëœ ë°ì´í„°
					columnOptions : {
						resizable : true
					// ì»¬ëŸ¼ í¬ê¸° ì¡°ì ˆ ê°€ëŠ¥
					},
					rowHeaders:['rowNum'],
					columns : [
					{ 
						header : 'ì œí’ˆì½”ë“œ',
						name : 'productCode',
						align : 'center'
					},
					{
						header : 'ì œí’ˆëª…',
						name : 'productName',
						align : 'center'
					},
					{
						header : 'ë‹¨ê°€',
						name : 'unitPrice',
						align : 'center'
					},
					],
				});
	</script>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary"
					data-bs-dismiss="modal">ë‹«ê¸°</button>
			</div>
		</div>
	</div>
</div>
<!-- ì œí’ˆì½”ë“œ ëª¨ë‹¬ ë -->
<script>
//í–‰ í´ë¦­ ì´ë²¤íŠ¸
grid2.on('click', function(ev) {
    const clickedRow = ev.rowKey; // í´ë¦­ëœ í–‰
    const clickedData = grid2.getData()[clickedRow]; // í´ë¦­ëœ í–‰ì˜ ë°ì´í„°

    // ì„ íƒëœ ì œí’ˆì„ ê¸°ì¡´ ì œí’ˆ ëª©ë¡ì— ì¶”ê°€
    addProductToOrderList(clickedData);

    // ëª¨ë‹¬ì„ ë‹«ê¸°
    $('#productCodeModal').modal('hide');
});

// ì œí’ˆ ëª©ë¡ì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function addProductToOrderList(product) {
    const currentData = grid.getData();  // ê¸°ì¡´ì˜ ì œí’ˆ ëª©ë¡ ë°ì´í„°

    // ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€
    currentData.push({
        no: currentData.length + 1,  // NO (ìë™ ì¦ê°€)
        productCode: product.productCode,
        productName: product.productName,
        unitPrice: product.unitPrice,
        orderQuantity: 1,
        orderAmount: product.unitPrice  // ì£¼ë¬¸ ê¸ˆì•¡ì€ ë‹¨ê°€ * ìˆ˜ëŸ‰
    });

    // ê·¸ë¦¬ë“œ ë°ì´í„° ê°±ì‹ 
    grid.resetData(currentData);
}

    // í•„í„°ë§ í•¨ìˆ˜ (ê²€ìƒ‰ì°½ì—ì„œ ì…ë ¥ë°›ì€ í…ìŠ¤íŠ¸ë¡œ í•„í„°ë§)
function filterGrid() {
    const productCode = document.getElementById('productCodeSearch').value.toLowerCase();
    const productName = document.getElementById('productNameSearch').value.toLowerCase();

    // productList ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í•„í„°ë§ ìˆ˜í–‰
    const filteredData = productList.filter(product => {
        return product.productCode.toLowerCase().includes(productCode) &&
               product.productName.toLowerCase().includes(productName);
    });

    // í•„í„°ë§ëœ ë°ì´í„°ë¥¼ Toast Gridì— ì ìš©
    grid2.resetData(filteredData);
}
</script>
<!-- ì—…ì²´ì½”ë“œ ëª¨ë‹¬ -->
<div class="modal fade" id="companyCodeModal" tabindex="-1"
	aria-labelledby="companyCodeModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="companyCodeModalLabel">ì—…ì²´ì½”ë“œ ì„ íƒ</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<!-- ì—…ì²´ì½”ë“œ ì„ íƒ ë¦¬ìŠ¤íŠ¸ë‚˜ ê²€ìƒ‰ -->
				<input type="text" class="form-control" placeholder="ê²€ìƒ‰ ì¡°ê±´ ì…ë ¥" />
				<!-- ì˜ˆì‹œ: ì—…ì²´ì½”ë“œ ë¦¬ìŠ¤íŠ¸ -->
				<ul>
					<li>ì—…ì²´ì½”ë“œ1</li>
					<li>ì—…ì²´ì½”ë“œ2</li>
					<li>ì—…ì²´ì½”ë“œ3</li>
				</ul>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary"
					data-bs-dismiss="modal">ë‹«ê¸°</button>
			</div>
		</div>
	</div>
</div>
<!-- ì—…ì²´ì½”ë“œ ëª¨ë‹¬ ë -->
<script>
$('#productCodeModal').on('shown.bs.modal', function () {
    console.log("ğŸ” ëª¨ë‹¬ì´ ì—´ë ¸ì–´ìš”! Grid ë¦¬ì‚¬ì´ì§• ì‹¤í–‰!");
    setTimeout(() => {
        grid2.refreshLayout();
        console.log("âœ… Grid ë¦¬ì‚¬ì´ì§• ì™„ë£Œ!");
    }, 100);
});

  // ì£¼ë¬¸ì½”ë“œ ëª¨ë‹¬ ì—´ê¸°
  function showOrderCodeModal() {
    var orderCodeModal = new bootstrap.Modal(document.getElementById('orderCodeModal'));
    orderCodeModal.show();
  }

  // ì—…ì²´ì½”ë“œ ëª¨ë‹¬ ì—´ê¸°
  function showCompanyCodeModal() {
	  $('#companyCodeModal').modal('show');x
  }
  
</script>
<style>
.modal {
	display: block !important; /* Bootstrap ê¸°ë³¸ ë™ì‘ ìš°íšŒ */
	visibility: hidden;
}

.modal.show {
	visibility: visible;
}
</style>
</html>
