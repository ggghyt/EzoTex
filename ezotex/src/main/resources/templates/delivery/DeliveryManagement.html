<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
      layout:fragment="content">
	<head>
		<meta charset="UTF-8">
		<title>이조텍스SCM</title>
		<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
		<style>
			.search-bar {
				width: 800px;
				height: 300px;
				-webkit-box-shadow: 0 0 0 0 rgba(90, 113, 208, 0), 0 4px 16px 0 rgba(167, 175, 183, 0);
				display: inline-block;
				flex-direction:row;
			}

			.order-list {
				width: 800px;
				height: 778px;
			}
			.order-info{
				margin-top: 0;
				margin-left: 30px;
				width: 500px;
				height: 100%;
			}
			.search-unit {
				display: flex;
				margin-bottom:5px;
			}
			.search-unit div {
				display: inline-block;
			}
			.search-bar > div {
			    display: inline-block;
			    vertical-align: top; /* 정렬 보정 */
			}
			.search-bar div:nth-of-type(1) {
				padding-left:10px;
				width: 300px;
			}
			.search-bar div:nth-of-type(2) {
				padding-left:10px;
				width: 410px;
			}
			.search-unit span {
				font-size: smaller;
				line-height: 2.5;
				width: 67px;
			}
			.search-bar div:nth-of-type(1) input{
				margin-left: 10px;
			}
			.search-bar div input[type=text] {
				width: 140px;
			}
			.search-bar select {
			    margin-left: 10px;
				width: 140px;
				border: 1px solid #dee2e6;
			    font-weight: 400;
			    font-size: 0.875rem;
			    border-radius: 4px;
			    height: 2rem;
			}
			input[type=date] {
				width: 140px;
			}
			.search-bar input[type=number] {
				width: 140px;
			}
			.dash {
				line-height: 1.9;
				margin-left: 2px;
				margin-right: 2px;
			}
			.search-bar b {
				display: block;
				margin-bottom:5px;
			}
			.order-list b{
				display: block;
				margin-bottom:5px;
			}
			.search-bar .btn-section{
				width: 390px !important;
				display: flex;
				justify-content: right;
				margin-bottom: 10px;
			}
			.btn-secondary {
				background-color: #b1b1b1;
			}
			.btn-section button:nth-of-type(2) {
				margin-left: 10px;
			}
			#order-details .table td{
				padding: 5px;
			}
			.table textarea {
				height: 60px;
			}
			#productListgrid {
			    width: 100%;
			    height: 280px; /* 충분한 높이를 설정 */
			}
			.detailAmount{
				margin-top: 10px;
				-webkit-box-shadow: 0 0 0 0 rgba(90, 113, 208, 0), 0 4px 16px 0 rgba(167, 175, 183, 0);
			}
			.detailAmount input[type=number] {
				width: 120px;
				margin-right: 20px;
				margin-left: 5px;
			}
			.input-details {
				display: flex;
				line-height: 1.9;
			}
			.completeBtn-section {
				display: flex;
				justify-content: center;
			}
			.completeBtn-section button {
				margin: 10px;
			}
			#productListgrid {
				height: 300px;
			}
		</style>
		
	</head>
	<body>
		<h3 class="fs-3 fw-bold">| 납품 관리</h3>
		<div id="container row" style="display: flex;">
			<div class="col">			
				<div class="p-3 mb-2 bg-secondary text-dark card search-bar">
					
					<b>납품 목록 검색</b>
										
					<!-- 검색조건1: 주문 코드, 납품 코드, 제품코드, 제품명, 주문담당자, 납품담당자, 상태 -->
					<div>
						<span class="search-unit">
							<span>주문 코드</span>
							<input type="text" class="form-control search-order-code">
						</span>
						<span class="search-unit">
							<span>납품 코드</span>
							<input type="text" class="form-control search-delivery-code">
						</span>
						<span class="search-unit">
							<span>주문담당자</span>
							<input type="text" class="form-control search-order-charger">
						</span>
						<span class="search-unit">
							<span>남품담당자</span>
							<input type="text" class="form-control search-delivery-charger">
						</span>
						<span class="search-unit">
							<span>상태</span>
							<select class="search-status">
								<option value="">전체</option>
								<option value="RS01">등록전</option>
								<option value="RS02">등록완료</option>
							</select>
						</span>

					</div>
					
					<!-- 검색조건2: 주문일 납기일 수량합계 급액합계 업체코드 업체명 -->
					<div>
						
						<span class="search-unit">
							<span>주문일</span>
							<input type="date" class="form-control search-order-date-start"> <b class="dash">-</b> 
							<input type="date" class="form-control search-order-date-end">
						</span>
						<span class="search-unit">
							<span>납기일</span>
							<input type="date" class="form-control search-order-dedt-start"> <b class="dash">-</b> 
							<input type="date" class="form-control search-order-dedt-end">
						</span>
						<span class="search-unit">
							<span>급액합계</span>
							<input type="number" class="form-control search-amount-start"> <b class="dash">-</b> 
							<input type="number" class="form-control search-amount-end">
						</span>
						<span class="search-unit">
							<span>업체코드</span>
							<input type="text" class="form-control search-company-code"> 
						</span>
						<span class="search-unit">
							<span>업체명</span>
							<input type="text" class="form-control search-company-name"> 
						</span>

						<div class="btn-section">						
							<button class="btn btn-warning mag-glass-btn" onclick="searchOrderList()"><i class="fa-solid fa-magnifying-glass icon-left" style="color: #ffffff;"></i></button>
							<button class="btn btn-secondary mag-glass-btn" onclick="resetCondition()"><i class="fa-solid fa-repeat icon-left" style="color: #ffffff;"></i></button>
						</div>
					</div>
				</div>
				<div class="card card-body mt-3 order-list">
					<b>주문 목록</b>
					<div id="grid"></div>
				</div>
			</div>	
			<div class="col card card-body order-info">			
				<div id="order-details">
					<b>납품 등록</b>
					<table class="table mt-3">
						<tbody>
							<tr>
								<td>구매업체코드</td>
								<td><input type="text" class="form-control input-company-code" disabled></td>
								<td>구매업체명</td>
								<td><input type="text" class="form-control input-company-name" disabled></td>
							</tr>
							<tr>
								<td>납품주소</td>
								<td colspan="3"><input type="text" class="form-control input-address" disabled></td>

							</tr>
							<tr>
								<td>주문일</td>
								<td><input type="text" class="form-control input-order-date" disabled></td>
								<td>납기일</td>
								<td><input type="text" class="form-control input-dedt" disabled></td>
							</tr>
							<tr>
								<td>주문담당자</td>
								<td><input type="text" class="form-control input-order-charger" disabled></td>
								<td>납품담당자</td>
								<td><input type="text" class="form-control input-delivery-charger" disabled></td>
							</tr>
							<tr>
								<td>제품수량합계</td>
								<td><input type="text" class="form-control input-total-qy" disabled></td>
								<td>주문금액합계</td>
								<td><input type="text" class="form-control input-total-price" disabled></td>
							</tr>
							<tr>
								<td>비고</td>
								<td colspan="3"><textarea class="form-control input-memo"></textarea></td>
							</tr>
							<tr>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="product-info">
					<b>납품 제품 상세</b>
					<div id="productListgrid"></div>
				</div>
				<div id="product-details">
					<b>납품 수량 입력</b>
					<div id="productDetailgrid"></div>
					<div class="p-3 mb-2 bg-secondary text-dark card detailAmount">
						<span class="input-details">
							
							<span>재고</span>
							<input type="number" class="form-control" disabled>
							<span>주문수량</span>
							<input type="number" class="form-control" disabled>
							<span>출고수량</span>
							<input type="number" class="form-control">
							<button class="btn btn-secondary">수량<br>등록</button>
						</span>
					</div>
				</div>
				<div class="completeBtn-section">
					<button class="btn btn-success">등록</button>
					<button class="btn btn-secondary">초기화</button>
				</div>
			</div>
		</div>
		
		
		<script>
			//
		    const dataSource = {
		  	      api: {
		  	          readData: { url: '/delivery/orderList' , method: 'GET' },
		  	        },
		  	      contentType: 'application/json',
		  	    };  

	        const grid = new Grid({
	            el: document.getElementById('grid'),
	            rowHeaders: ['rowNum'],
	            pageOptions: {
	                useClient: false,    //데이터를 한번에 다 가져옴. 나중에 false로 할 예정
	                perPage: 15
	            },
	            bodyHeight: 619,
	            columnOptions: {
	  	          resizable: true
	  	      	},
	            columns: [
	                { header : "주문코드", name: "productOrderCode"},
	                { header : "납품코드", name: "deliveryCode"},
	                { header : "업체코드", name: "companyCode"},
	                { header : "구매업체명", name: "company"},
	                { header : "요약", name: "summary"},
	                { header : "상태", name: "orderStatus"},
	                { header : "남품담당자", name: "chargerName"},
	                { header : "주문일", name: "orderDate"},
	                { header : "납기일", name: "dedt"}
	            ],
	            data: dataSource
	        });
	        
	        
	        
	        let lastClicked = null; // 페이지 이동 시에도 이전 선택 기억하기 위함.
			
	        grid.on('focusChange', ev => {
	            // 배경색 클래스 적용
	            grid.removeRowClassName(lastClicked, 'bg-blue'); // 이전 선택 행 배경색 삭제
	            grid.addRowClassName(ev.rowKey, 'bg-blue'); // 선택된 행 배경색 추가
	            lastClicked = ev.rowKey; // 선택된 행 기억

	            // 선택한 정보 가져오기
	            let selected = grid.getRow(ev.rowKey);
	            
	            console.log(selected);
	            document.querySelector('.input-company-code').value = selected.company;
	            document.querySelector('.input-company-name').value = selected.companyCode;
	            document.querySelector('.input-order-date').value = selected.orderDate;
	            document.querySelector('.input-dedt').value = selected.dedt;
	            /*구매업체코드, 구매업체명,
	            납품주소, 주문일, 납기일
	            주문담당자, 납품담당자,
	            제품수량합계, 주문금액합계,
	            비고
	            제품코드, 대분류, 소분류, 제품명, 출고량 합계*/
	            
	        }); 
	        function searchOrderList() {
	        	grid.readData(1, {
	        		orderCode: document.querySelector('.search-order-code').value,
	        		deliveryCode: document.querySelector('.search-delivery-code').value,
	        		orderCharger:  document.querySelector('.search-order-charger').value,
	        		deliveryCharger: document.querySelector('.search-delivery-charger').value,
	        		orderDateStart: document.querySelector('.search-order-date-start').value,
	        		orderDateEnd: document.querySelector('.search-order-date-end').value,
	        		dedtStart: document.querySelector('.search-order-dedt-start').value,
	        		dedtEnd: document.querySelector('.search-order-dedt-end').value,
	        		totalAmountStart: document.querySelector('.search-amount-start').value,
	        		totalAmountEnd: document.querySelector('.search-amount-end').value,
	        		companyCode: document.querySelector('.search-company-code').value,
	        		companyName: document.querySelector('.search-company-name').value,
	        		status: document.querySelector('.search-status').value
	        		
	        	}, false);	//안에 값 넣으면 됨 파라미터 세개 (1:몊번째 페이지 불러올 것인가, 2:검색조건, 3:true=기존데이터 초기화)
	        }
	        
	        //검색 조건 삭제
	        function resetCondition() {
        		document.querySelectorAll('.search-bar input').forEach((e) => {
        			e.value = null;
        		})
        		document.querySelector('.search-bar select')
	        }
	        
	        //주문 헤더정보
	        
	        
	        //제품 목록
	        const productListgrid = new Grid({
	            el: document.getElementById('productListgrid'),
	            bodyHeight: 250,
	            scrollY: true,
		        scrollX: false,
	            rowHeaders: ['rowNum'],
	            columns: [
	                { header: "제품코드", name: "productCode"},
	                { header: "대분류", name: "lclas"},
	                { header: "소분류", name: "sclas"},
	                { header: "제품명", name: "productName"},
	                { header: "출고량합계", name: "qy"}
	            ],
	            data: [
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                { productCode: "", lclas: "", sclas: "", productName: "", qy: "" },
	                
	            ]
	        });
			
	        //제품 상세 수량
		    const productDetailgrid = new Grid({
			      el: document.getElementById('productDetailgrid'),
		            scrollY: true,
			        scrollX: false,
			        columns: [
			            { header: "색상", name: "color"},
			            { header: "S", name: "S"},
			            { header: "M", name: "M"},
			            { header: "L", name: "L"},
			            { header: "XL", name: "XL"}
			        ],
			        data: [
			            { color: "", S: "", M: "", L: "", XL: "" },
			            { color: "", S: "", M: "", L: "", XL: "" },
			            { color: "", S: "", M: "", L: "", XL: "" },
			            { color: "", S: "", M: "", L: "", XL: "" },
			            { color: "", S: "", M: "", L: "", XL: "" }
			        ],
			    });

    	</script>
	</body>
</html>