<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
      layout:fragment="content">
	<head>
		<meta charset="UTF-8">
		<title>ì´ì¡°í…ìŠ¤SCM</title>
		<!-- timePicker -->
	    <link rel="stylesheet" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css" />
	    <script src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.js"></script>
	  
	    <!-- datePicker -->
	    <link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
	    <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
	  
	  	<!-- paging -->
	    <link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
	    <script src="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.js"></script>
	  
	    <!-- toast grid -->
	    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
		<style type="text/css">
			#modalGrid {
			    width: 100%;
			    height: 400px; /* ë˜ëŠ” ì›í•˜ëŠ” ë†’ì´ ì„¤ì • */
			}
		</style>
	</head>
	<body>
	
		<!-- Modal1 -->
	   <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	      <div class="modal-dialog modal-xl" >
	         <div class="modal-content">
	          <div class="modal-header">
	             </div>
	           <div class="card">
	                <div class="card-body">
	                  <div class="mb-3 row">
	                <label for="inputPassword" class="col-sm-2 col-form-label">ê²€ìƒ‰ì¡°ê±´1</label>
	                <div class="col-sm-10">
	                  <input type="text" class="form-control" id="inputPassword" style="width:200px;">
	                </div>
	              </div>
	                  <div class="mb-3 row">
	                <label for="inputPassword" class="col-sm-2 col-form-label">ê²€ìƒ‰ì¡°ê±´2</label>
	                <div class="col-sm-10">
	                  <input type="text" class="form-control" id="inputPassword" style="width:200px;">
	                </div>
	              </div>
	           
	                  <div id="modalGrid"></div>
	                 </div>
	              </div>
	            <div style="text-align: center; margin: 20px;">
	               <button type="button" class="btn btn-outline-primary btn-fw">ìˆ˜ì •</button>
	               <button type="button" class="btn btn-inverse-dark btn-fw"data-bs-dismiss="modal">ì·¨ì†Œ</button>
	           </div>
	         </div>
	         </div>
	      </div>
	
	
	
		<div class="d-flex align-items-center">
		<h3 class="fs-3 fw-bold">| ìì¬/ì œí’ˆ ì…ê³  ë“±ë¡</h3>
		<button class="btn btn-secondary" style="margin:10px;">ìì¬ ì…ê³ </button>
		<button class="btn btn-secondary" style="margin:10px;">ì œí’ˆ ì…ê³ </button>
		</div>
		<div class="card card-body mt-3">
			<div class="col-12 card card-body m-2">
				<div class="row g-3 align-items-center">
			  		<div class="col-auto">
			    		<label class="col-form-label">ë‚©í’ˆì½”ë“œ</label>
			  		</div>
			  		<div class="col-auto">
			    		<input type="text" id="" class="form-control">
			  		</div>
				</div>
				<div class="row g-3 align-items-center">
			  		<div class="col-auto">
			    		<label class="col-form-label">ê²€ìƒ‰ì¡°ê±´2</label>
			  		</div>
			  		<div class="col-auto">
			    		<input type="text" id="" class="form-control">
			  		</div>
				</div>
			</div>
			
			
			<div class="row">
				<div class="col-5 card card-body m-2">
					<div id="grid"></div>
  					<div id="pagination" class="tui-pagination"></div>
				</div>
				
				<div class="col-5 card card-body m-2">
					<p class="fs-5 fw-bolder mt-2">ì…ê³  ë“±ë¡</p>
						<div id="grid2"></div>
						
					<p class="fs-5 fw-bolder mt-2">ì…ê³  ìˆ˜ëŸ‰ ì…ë ¥</p>
						<div id="grid3"></div>
						
					<p class="fs-5 fw-bolder mt-2">ë¶ˆëŸ‰ ë°œìƒ ë‚´ì—­</p>
						<div id="grid4"></div>
						
					<div class="d-flex justify-content-end mt-2">
						<button class="btn btn-primary" style="margin:10px;">ë“±ë¡</button>
						<button class="btn btn-secondary" style="margin:10px;">ì´ˆê¸°í™”</button>
					</div>
					
				</div>
			</div>
			
		</div>
		
	    <!-- Toast UI Grid ìŠ¤í¬ë¦½íŠ¸ -->
	    <script>
	    
	    let test = document.getElementById('pagination')
	    
	    console.log(test);
	    
	    //const Grid = tui.Grid;
	    
	    
	   
	   	/*
	   	*========================================================================
	   	* ì…ê³  ëŒ€ê¸° ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ ë° ê·¸ë¦¬ë“œ
	   	*========================================================================
	   	*/
	    const dataSource = {
	      api: {
	          readData: { url: 'http://localhost:80/store/deliveryList', method: 'GET' },
	        },
	      contentType: 'application/json',
	    };  
	    
	    const storeGrid = new Grid({
	      el: document.getElementById('grid'), // ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸
	      rowHeaders: ['rowNum'],
	      columnOptions: {
	          resizable: true
	      },
	      columns: [ 
	        { header: "ë‚©í’ˆ ì½”ë“œ", name: "deliveryCode", align: "center"},
	        { header: "ì œí’ˆ ì¢…ë¥˜ ìˆ˜", name: "deliveryQy", align: "center"},
	        { header: "ë‚©í’ˆ ìš”ì²­ì¼", name: "orderDate", align: "center"},
	        { header: "ì…ê³  ì˜ˆì •ì¼", name: "dedt", align: "center"},
	      ],
	      data: dataSource,
	    });
	    
	    /*
	   	*========================================================================
	   	* ì…ê³  ëŒ€ê¸° ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ ë° ê·¸ë¦¬ë“œ END!!
	   	*========================================================================
	   	*/
	    
	   	
	   	/*
	   	*========================================================================
	   	* ì…ê³  ëŒ€ê¸° ì œí’ˆ ìƒì„¸ì¡°íšŒ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ ë° ê·¸ë¦¬ë“œ
	   	*========================================================================
	   	*/

	   	
	    const storeGrid2 = new Grid({
		      el: document.getElementById('grid2'), // ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸
		      rowHeaders: ['rowNum'],
		      columns: [ 
			        { header: "ì œí’ˆ ì½”ë“œ", name: "productCode", align: "center"},
			        { header: "ì œí’ˆëª…", name: "productName", align: "center"},
			        { header: "ìš”ì²­ ìˆ˜ëŸ‰", name: "productQy", align: "center"},
			        { header: "ì…ê³ ëŸ‰ í•©ê³„", name: "", align: "center"},
			        { header: "ë¶ˆëŸ‰ í•©ê³„", name: "", align: "center"},
			        { header: "ì¶”ì²œ ìœ„ì¹˜", name: "dedt", align: "center"},
			        { header: "ì°½ê³ ìœ„ì¹˜", name: "ì°½ê³ ìœ„ì¹˜", align: "center"},
			  ],
			  data: ""
		    });
	    // í´ë¦­ ì´ë²¤íŠ¸ í›„ í´ë¦­ í–‰ ë°ì´í„° ê¸°ë°˜ ìƒì„¸ì¡°íšŒ
	    storeGrid.on('click', ev => {
	    	
	    	let data = storeGrid.getRow(ev.rowKey);
	    	
	    	fetch(`http://localhost:80/store/deliveryDetailsList?deliveryCode=${data.deliveryCode}`)
	    		.then(rep => rep.json())
	    		.then(data => {
	    				storeGrid2.resetData(data);
	    			})
	    		})
	    		
	    /*
	   	*========================================================================
	   	* ì…ê³  ëŒ€ê¸° ì œí’ˆ ìƒì„¸ì¡°íšŒ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ ë° ê·¸ë¦¬ë“œ END!!
	   	*========================================================================
	   	*/		
	    
	   	
	   	
	   	
	   	/*
	   	*========================================================================
	   	* ì…ê³  ëŒ€ê¸° ì œí’ˆ ì˜µì…˜ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ ë° ê·¸ë¦¬ë“œ
	   	*========================================================================
	   	*/
	   	
	    const storeGrid3 = new Grid({
		      el: document.getElementById('grid3'), // ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸
	            scrollY: true,
		        scrollX: false,
		        header: {
		        height: 80,
		            complexColumns: [
		              {
		                header: 'S',
		                name: 'stest',
		                childNames: ['storeS', 's']
		              },
		              {
			             header: 'M',
			             name: 'mtest',
			             childNames: ['ì…ê³ í• ìˆ˜ëŸ‰m', 'm']
			          },
			          {
				         header: 'L',
				         name: 'ltest',
				         childNames: ['ì…ê³ í• ìˆ˜ëŸ‰l', 'l']
				      },
				      {
					      header: 'XL',
					      name: 'xltest',
					      childNames: ['ì…ê³ í• ìˆ˜ëŸ‰xl', 'xl']
					  }
		             ]},
		        columns: [
		            { header: "ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ", name: "productColor", align: "center" },
		            { header: "ì…ê³ í• ìˆ˜ëŸ‰", name: "storeS", align: "center", editor: "text"},
		            { header: "ìš”ì²­ìˆ˜ëŸ‰", name: "s", align: "center" },
		            { header: "ì…ê³ í• ìˆ˜ëŸ‰", name: "ì…ê³ í• ìˆ˜ëŸ‰m", align: "center", editor: "text"},
		            { header: "ìš”ì²­ìˆ˜ëŸ‰", name: "m", align: "center" },
		            { header: "ì…ê³ í• ìˆ˜ëŸ‰", name: "ì…ê³ í• ìˆ˜ëŸ‰l", align: "center", editor: "text"},
		            { header: "ìš”ì²­ìˆ˜ëŸ‰", name: "l", align: "center" },
		            { header: "ì…ê³ í• ìˆ˜ëŸ‰", name: "ì…ê³ í• ìˆ˜ëŸ‰xl", align: "center", editor: "text"},
		            { header: "ìš”ì²­ìˆ˜ëŸ‰", name: "xl", align: "center" }
		        ],
	            data : ""
		    });
	    
	    // ì„ íƒí•œ ì œí’ˆì½”ë“œ ê°’ ì €ì¥ ë³€ìˆ˜
	    let productCode = "";
	    
	    // ì œí’ˆ ìƒì„¸ë³´ê¸° ê·¸ë¦¬ë“œ í´ë¦­ ì´ë²¤íŠ¸
	    storeGrid2.on('click', ev => {
	    	let data = storeGrid2.getRow(ev.rowKey);
	    	
	    	// ì°½ê³  ìœ„ì¹˜ ì»¬ëŸ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì¶œë ¥
	    	if(ev.columnName === 'ì°½ê³ ìœ„ì¹˜'){
	    		 let modal = new bootstrap.Modal(document.getElementById('exampleModal'));
	    	     modal.show();
	    	}else if(ev.columnName != 'ì°½ê³ ìœ„ì¹˜'){
	    		
	    		// ì„ íƒí•œ ì œí’ˆì½”ë“œ ì €ì¥
	    		productCode = data.productCode
	    		
		    	fetch(`http://localhost:80/store/productCodeList?productCode=${data.productCode}`)
		    		.then(rep => rep.json())
		    		.then(data => {
		    				storeGrid3.resetData(data);
		    	})	
	    	}
	    	})
	    	
	    	
	    // ì œí’ˆ ì˜µì…˜ ê·¸ë¦¬ë“œ ì²´ì¸ì§€ ì´ë²¤íŠ¸(í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ë³€ê²½ê°’)
	    storeGrid3.on('afterChange', ev => {
	    	console.log('ì„ íƒ ì œí’ˆì½”ë“œ', productCode);
		    if (!ev || !ev.changes) return; // ev ë˜ëŠ” ë³€ê²½ëœ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì¢…ë£Œ
		    ev.changes.forEach(change => {
		    	
		    	// ë³€ê²½ë˜ëŠ” í–‰ ë°ì´í„° ë‹´ê¸°
		        let data = storeGrid3.getRow(change.rowKey);
		    	// ë³€ê²½ë˜ëŠ” ì…€ ë°ì´í„°
		        let newValue = Number(change.value);
		        // ë³€ê²½ë˜ëŠ” ì…€ì— ìµœëŒ€ ê°’ 
		        let maxValue = Number(data["s"]);
		        
		        console.log('ê¸°ì¡´ê°’ ',maxValue);
		        
		        console.log('ë³€ê²½ëœ í–‰ ë°ì´í„°:', newValue);
		        
		        // ğŸš¨ ì…ë ¥ê°’ì´ ê¸°ì¡´ ê°’ë³´ë‹¤ í¬ë©´ ê²½ê³  í›„ ë³€ê²½ ì·¨ì†Œ
		        if (newValue > maxValue) {
		            alert(`ì…ë ¥ê°’ì€ ${maxValue}ë³´ë‹¤ í´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
		            
		            // ê¸°ì¡´ ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
		            newValue = maxValue;				// ê°’ì€ ë³€ê²½ ë˜ëŠ”ë°.... í™”ë©´ì— ê°’ì´ ë³€ê²½ì´ ì•ˆë¨ í•´ê²°ì¢€ ;;
		            
		        }
		    });
		});

	    
	    /*
	   	*========================================================================
	   	* ì…ê³  ëŒ€ê¸° ì œí’ˆ ì˜µì…˜ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ ë° ê·¸ë¦¬ë“œ END!!
	   	*========================================================================
	   	*/	
	    
	    const storeGrid4 = new Grid({
		      el: document.getElementById('grid4'), // ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸
	            scrollY: true,
		        scrollX: false,
		      rowHeaders: ['rowNum'],
		      columns: [ 
		        { header: "ì œí’ˆ ì½”ë“œ", name: "deliveryCode", editor: "text"},
		        { header: "ì œí’ˆëª…", name: "companySe", editor: "text"},
		        { header: "ìƒ‰ìƒ", name: "orderDate", editor: "text"},
		        { header: "ì‚¬ì´ì¦ˆ", name: "dedt", editor: "text"},
		        { header: "ë¶ˆëŸ‰ ìˆ˜ëŸ‰", name: "dedt", editor: "text"},
		        { header: "ë¶ˆëŸ‰ ì‚¬ìœ ", name: "dedt", editor: "text"},
		      ],
		      data: dataSource,
		    });
	    
	    
	    const storeGrid5 = new Grid({
	    	el: document.getElementById('modalGrid'),
	    	rowHeaders: ['rowNum'],
	    	columns: [
	    		 { header: "ì°½ê³ ìœ„ì¹˜", name: "dedt" },
			     { header: "ì…ê³ ê°€ëŠ¥ ìˆ˜ëŸ‰", name: "dedt" },
			     { header: "ì ì¬ëœ ì œí’ˆ ì¢…ë¥˜ ìˆ˜", name: "dedt" },
	    	],
	    	data: ""
	    })
	    
	 // Bootstrap ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
		const modalElement = document.getElementById('exampleModal');

		modalElement.addEventListener('show.bs.modal', function () {
		    modalElement.style.display = 'block'; // ëª¨ë‹¬ì„ ë¸”ë¡ìœ¼ë¡œ ë³€ê²½
		    modalElement.style.opacity = '0'; // íˆ¬ëª…í•˜ê²Œ ìˆ¨ê¹€
		});
		
		modalElement.addEventListener('shown.bs.modal', function () {
		    storeGrid5.refreshLayout();  // ëª¨ë‹¬ì´ ì™„ì „íˆ ëœ¬ í›„ í¬ê¸° ì¡°ì •
		    modalElement.style.opacity = '1'; // íˆ¬ëª…ë„ ë³µì›
		});


	    
	    </script>
	    
	   <button type="button" class="btn btn-primary"
                  data-bs-toggle="modal" data-bs-target="#exampleModal">
                  ModalTest2</button>
	    
	</body>
</html>